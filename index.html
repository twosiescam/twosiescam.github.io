<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Twosies</title>
  <link id="favicon" rel="icon" type="image/png" href="favicon.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#050505">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Twosies">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="stylesheet" href="style.css">
  
  <!-- Register Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('SW Registered', reg.scope))
          .catch(err => console.log('SW Registration Failed', err));
      });
    }
  </script>
</head>
<body class="bg-black overflow-hidden h-screen w-screen selection:bg-none">

  <!-- Main Container: Dark, Industrial -->
  <main class="relative w-full h-full bg-zinc-950 flex flex-col items-center justify-center font-mono overflow-hidden">
    
    <!-- App Title (Minimal) -->
    <div class="absolute top-4 left-4 z-20 opacity-50 pointer-events-none hidden md:block">
      <h1 class="text-xs font-bold tracking-widest text-zinc-500 uppercase">Twosies</h1>
    </div>

    <!-- Flash Toggle (Top Left) -->
    <button id="btn-flash" class="absolute top-4 left-4 z-50 text-zinc-500 hover:text-white p-2 flex items-center gap-1 transition-colors md:left-20 safe-top">
      <div class="relative w-6 h-6 flex items-center justify-center">
          <!-- Bolt Icon -->
          <svg id="icon-flash" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" class="text-zinc-600">
              <path d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"/>
          </svg>
          <!-- Off Slash -->
          <div id="flash-off-slash" class="absolute w-[2px] h-[24px] bg-zinc-500 rotate-45"></div>
          <!-- Auto text -->
          <span id="flash-auto-text" class="hidden absolute -right-1 -bottom-1 text-[8px] font-bold text-zinc-400 bg-black/50 px-[2px] rounded">A</span>
      </div>
    </button>

    <!-- Settings Toggle Button (Top Right) -->
    <button id="btn-settings" class="absolute top-4 right-4 z-50 text-zinc-500 hover:text-white p-2 safe-top">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
          <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
      </svg>
    </button>

    <!-- SETTINGS MODAL -->
    <div id="modal-settings" class="hidden absolute inset-0 z-[60] bg-black/95 flex flex-col p-6 overflow-y-auto safe-top safe-bottom">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-zinc-300">SETTINGS</h2>
            <button id="btn-close-settings" class="text-zinc-500 hover:text-white font-bold px-4 py-2 border border-zinc-700 rounded">CLOSE</button>
        </div>
        
        <div class="grid gap-6 max-w-md mx-auto w-full pb-20" id="settings-container">
           <!-- Generated by JS -->
        </div>
    </div>

    <!-- Viewfinder Area -->
    <div id="viewfinder" class="relative w-full max-w-md bg-black shadow-2xl md:rounded-sm border-2 border-zinc-800 flex items-center justify-center transition-all duration-300 aspect-[4/3]">
      
      <!-- ERROR STATE -->
      <div id="error-display" class="hidden absolute inset-0 flex items-center justify-center text-zinc-500 bg-zinc-900 z-50 p-6 text-center">
        <div>
          <p class="text-xl mb-2 font-bold">NO SIGNAL</p>
          <p id="error-message" class="text-xs border border-zinc-700 p-2"></p>
        </div>
      </div>

      <!-- HIDDEN SOURCE VIDEO -->
      <video id="videoElement" autoplay playsinline muted class="absolute top-0 left-0 w-1 h-1 opacity-0 pointer-events-none"></video>

      <!-- LIVE PROCESSED CANVAS VIEWFINDER -->
      <div id="canvas-container" class="absolute inset-0 w-full h-full bg-black flex items-center justify-center overflow-hidden">
          <canvas id="canvasElement" class="w-full h-full object-contain pixelated bg-[#111]"></canvas>
      </div>

      <!-- CAPTURED PHOTO RESULT -->
      <div id="result-photo" class="hidden absolute inset-0 w-full h-full bg-black z-30 flex items-center justify-center">
        <img id="result-img" class="w-full h-full object-contain pixelated" alt="Captured retro photo">
      </div>

      <!-- CAPTURED VIDEO RESULT -->
      <div id="result-video" class="hidden absolute inset-0 w-full h-full bg-black z-30 flex items-center justify-center">
        <video id="result-vid" controls autoplay loop playsinline class="w-full h-full object-contain pixelated"></video>
      </div>

      <!-- RECORDING INDICATOR -->
      <div id="indicator-rec" class="hidden absolute top-4 left-1/2 -translate-x-1/2 z-50 flex items-center gap-2 bg-black/50 px-3 py-1 rounded-full border border-red-900/50">
        <div class="w-3 h-3 rounded-full bg-red-600 animate-blink"></div>
        <span id="text-rec-state" class="text-red-500 font-bold text-xs tracking-wider">REC</span>
      </div>

      <!-- ZOOM LEVEL INDICATOR -->
      <div id="indicator-zoom" class="hidden absolute bottom-4 right-4 z-40 text-xs font-bold text-yellow-500/50 border border-yellow-500/30 px-2 py-1 bg-black/50 rounded">
          1.0x
      </div>

      <!-- WHITE FLASH OVERLAY -->
      <div id="flash-overlay" class="hidden absolute inset-0 bg-white z-50 animate-out fade-out duration-150"></div>
    </div>

    <!-- Controls Area -->
    <div class="mt-8 w-full max-w-sm px-8 flex justify-between items-center z-50 safe-bottom">
      
      <!-- Placeholder Counter (Left) -->
      <div class="flex flex-col items-center justify-center opacity-30 w-16">
           <div id="counter-text" class="text-xl font-bold font-mono tracking-widest text-zinc-500 select-none">
               RDY
           </div>
      </div>

      <!-- Main Button Center -->
      <div id="controls-capture" class="relative flex flex-col items-center">
          <!-- Locked State: Tap to Stop -->
          <button id="btn-stop-lock" class="hidden relative group outline-none tap-highlight-transparent select-none touch-none">
             <div class="w-20 h-20 rounded-full bg-zinc-800 border-4 border-zinc-700 shadow-xl flex items-center justify-center">
                 <div class="w-8 h-8 bg-zinc-300 rounded-sm"></div>
             </div>
             <p class="absolute -bottom-8 w-full text-center text-xs text-zinc-500 font-bold tracking-widest">STOP</p>
          </button>

          <!-- Recording / Ready State -->
          <div id="container-shutter" class="relative flex flex-col items-center">
              
              <!-- Lock Hint Indicator -->
              <div id="hint-lock" class="hidden absolute -top-16 opacity-70 animate-bounce transition-opacity duration-300 pointer-events-none flex flex-col items-center">
                   <div class="text-zinc-500 mb-1">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2m3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2M5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1"/>
                      </svg>
                   </div>
                   <span class="text-[10px] text-zinc-500 tracking-widest font-bold">LOCK</span>
              </div>

              <button id="btn-shutter" class="relative group outline-none tap-highlight-transparent select-none touch-none">
                  <!-- Outer Ring -->
                  <div id="shutter-outer" class="w-20 h-20 rounded-full bg-zinc-800 border-4 border-zinc-700 shadow-xl flex items-center justify-center transition-transform duration-100">
                      <!-- Inner Button -->
                      <div id="shutter-inner" class="w-16 h-16 rounded-full border-2 transition-all duration-300 shadow-inner bg-red-600 border-red-800"></div>
                  </div>
              </button>
          </div>
      </div>

      <!-- Action Buttons (Review) -->
      <div id="controls-review" class="hidden flex gap-4">
        <button id="btn-trash" class="h-12 px-6 rounded bg-zinc-900 text-zinc-400 font-bold border border-zinc-700 active:bg-zinc-800 text-sm tracking-wider hover:text-white transition-colors">
          TRASH
        </button>
        <button id="btn-save" class="h-12 px-6 rounded bg-amber-600 text-zinc-950 font-bold border border-amber-500 active:bg-amber-700 text-sm tracking-wider shadow-lg shadow-amber-900/20 hover:bg-amber-500 transition-colors">
          SAVE
        </button>
      </div>

      <!-- Right Control (Camera Flip) -->
      <div class="w-16 flex justify-center">
          <button id="btn-flip" class="p-3 text-zinc-600 hover:text-zinc-300 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/>
                  <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/>
              </svg>
          </button>
      </div>
    </div>

  </main>
  
  <script src="app.js"></script>
</body>
</html>
