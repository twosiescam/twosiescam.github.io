<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Twosies | Retro Camera</title>
  <link id="favicon" rel="icon" type="image/png" href="favicon.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#050505">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Twosies">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon.png">
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  
  <!-- Register Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('SW Registered', reg.scope))
          .catch(err => console.log('SW Registration Failed', err));
      });
    }
  </script>
</head>
<body>
  <!-- Main Container -->
  <main class="app-main">
    
    <!-- Flash Toggle -->
    <button id="btn-flash" class="btn-icon btn-flash safe-top">
      <div class="flash-icon-wrapper">
          <!-- Bolt Icon -->
          <span id="icon-flash">FLASH</span>
          <!-- Off Slash -->
          <div id="flash-off-slash" class="flash-slash"></div>
          <!-- Auto text -->
          <span id="flash-auto-text" class="hidden flash-auto-badge">A</span>
      </div>
    </button>

    <!-- Settings Toggle -->
    <button id="btn-settings" class="btn-icon btn-settings safe-top">
      OPTIONS
    </button>

    <!-- SETTINGS MODAL -->
    <div id="modal-settings" class="hidden modal-overlay safe-top safe-bottom">
        <div class="modal-header">
            <h2 class="modal-title">CONFIGURE TWOSIES CAMERA</h2>
            <button id="btn-close-settings" class="btn-close">EXIT</button>
        </div>
        
        <div id="settings-container" class="settings-list">
           <!-- Generated by JS -->
        </div>

        <!-- Backups List (Hidden by default, populated by JS) -->
        <div id="backups-section" class="backups-section hidden">
            <h3 class="modal-subtitle">RECENT PHOTOS (30 DAYS)</h3>
            <div id="backups-list" class="backups-grid"></div>
        </div>
    </div>

    <!-- Viewfinder Area -->
    <div id="viewfinder" class="viewfinder ratio-4-3">
      
      <!-- ERROR STATE -->
      <div id="error-display" class="hidden error-overlay">
        <div class="error-box">
          <p class="error-title">CANNOT CONNECT</p>
          <p id="error-message" class="error-msg"></p>
        </div>
      </div>

      <!-- HIDDEN SOURCE VIDEO -->
      <video id="videoElement" autoplay playsinline muted class="absolute inset-0" style="width:1px;height:1px;opacity:0;pointer-events:none;"></video>

      <!-- LIVE PROCESSED CANVAS VIEWFINDER -->
      <div id="canvas-container" class="canvas-container">
          <canvas id="canvasElement" class="pixelated"></canvas>
      </div>

      <!-- CAPTURED PHOTO RESULT -->
      <div id="result-photo" class="hidden canvas-container z-50">
        <img id="result-img" class="pixelated" alt="Captured retro photo">
      </div>

      <!-- CAPTURED VIDEO RESULT -->
      <div id="result-video" class="hidden canvas-container z-50">
        <video id="result-vid" controls autoplay loop playsinline class="pixelated"></video>
      </div>

      <!-- RECORDING INDICATOR -->
      <div id="indicator-rec" class="hidden indicator-rec">
        <div class="rec-dot animate-blink"></div>
        <span id="text-rec-state" class="rec-text">REC</span>
      </div>

      <!-- ZOOM LEVEL INDICATOR -->
      <div id="indicator-zoom" class="hidden indicator-zoom">
          1.0x
      </div>
    </div>

    <!-- Controls Area -->
    <div class="controls-area safe-bottom">
      
      <!-- Placeholder Counter (Left) -->
      <div class="counter-display">
           <div id="counter-text" class="counter-text">
           </div>
      </div>

      <!-- Main Button Center -->
      <div id="controls-capture" class="shutter-wrapper">
          <!-- Locked State: Tap to Stop -->
          <button id="btn-stop-lock" class="hidden btn-stop-lock">
             <div class="stop-outer">
                 <div class="stop-inner"></div>
             </div>
             <p class="stop-label">STOP</p>
          </button>

          <!-- Recording / Ready State -->
          <div id="container-shutter" class="shutter-wrapper">
              
              <!-- Lock Hint Indicator -->
              <div id="hint-lock" class="hidden lock-hint">
                   <div class="lock-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                          <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2m3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2M5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1"/>
                      </svg>
                   </div>
                   <span class="lock-text">LOCK</span>
              </div>

              <button id="btn-shutter" class="shutter-btn">
                  <!-- Outer Ring -->
                  <div id="shutter-outer" class="shutter-outer">
                      <!-- Inner Button -->
                      <div id="shutter-inner" class="shutter-inner"></div>
                  </div>
              </button>
          </div>
      </div>

      <!-- Action Buttons (Review) -->
      <div id="controls-review" class="hidden controls-review">
        <button id="btn-trash" class="btn-action btn-trash">
          EXIT
        </button>
        <button id="btn-save" class="btn-action btn-save">
          SAVE
        </button>
      </div>

      <!-- Right Control (Camera Flip) -->
      <div class="flip-wrapper">
          <button id="btn-flip" class="btn-flip">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/>
                  <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/>
              </svg>
          </button>
      </div>
    </div>

  </main>

  <!-- WHITE FLASH OVERLAY (Moved to root) -->
  <div id="flash-overlay" class="hidden flash-overlay"></div>
  
  <script src="app.js"></script>
</body>
</html>
